# A* Hybrid Avoidance & Control Tuning Guide

This document explains how to tune the navigation parameters in `planner.py` and `config.py` to achieve consistent obstacle avoidance and smooth trajectory tracking.

## 1. Safety & Map Inflation (`config.py`)

The most critical factor for avoidance is how "thick" the obstacles appear to the planner.

*   **`INFLATION_MARGIN_M`** (Default: `0.05` meters)
    *   **Effect:** Adds a safety buffer around every obstacle in the internal map. A higher value forces the A* path to stay further away from walls and buoys.
    *   **Tuning:**
        *   If the robot **grazes or hits obstacles** while following a path, **INCREASE** this to `0.20` or `0.30`.
        *   If the robot **refuses to pass** through a valid gate or narrow gap, **DECREASE** this.
        *   *Recommendation:* Set to `0.20` for better safety if gaps allow.

*   **`LIDAR_ACIL_DURMA_M`** (Default: `1.0` meters)
    *   **Effect:** The distance at which the robot triggers a "Shock Brake" and escape maneuver in Vision/Alignment modes.
    *   **Tuning:** Increase if the robot reacts too late.

## 2. Pure Pursuit Path Tracking (`planner.py`)

The `pure_pursuit_control` function determines how the robot follows the A* path. The key concept is the **Lookahead Distance** (the point on the path the robot aims for).

### Lookahead Parameters

*   **`MIN_L`** (Default: `1.0` meters)
    *   **Definition:** The minimum distance the robot looks ahead.
    *   **Effect:**
        *   **Small Value (e.g., 0.8):** Robot tracks the path very tightly. Good for avoidance but may cause oscillation (snaking).
        *   **Large Value (e.g., 2.0):** Robot drives smoother but "cuts corners".
    *   **Avoidance Issue:** If `MIN_L` is too large, the robot might aim at a point *behind* an obstacle that the path curves around, causing it to crash into the obstacle instead of following the curve.
    *   **Recommendation:** If crashing into obstacles on curves, **DECREASE** `MIN_L`.

*   **`LOOKAHEAD_GAIN`** (Default: `0.5`)
    *   **Definition:** Scales lookahead distance with speed (`Lookahead = MIN_L + (Speed * Gain)`).
    *   **Effect:** Increases stability at high speeds.

### Steering PID

*   **`TURN_KP`** (Default: `200.0`)
    *   **Effect:** How aggressively the robot turns to correct heading error.
    *   **Tuning:** If the robot reacts too slowly to a sharp turn in the path, **INCREASE** this. If it oscillates rapidly, **DECREASE**.

## 3. A* Planner Behavior (`config.py` & `planner.py`)

*   **`A_STAR_HEURISTIC_WEIGHT`** (Default: `2.5` or `3.0`)
    *   **Effect:** Determines how "greedy" the pathfinder is.
    *   **High Value:** Finds a path faster and prefers straight lines to the goal, potentially hugging obstacles closer.
    *   **Low Value (1.0):** Guarantees the absolute shortest path but is slower to calculate.

## Summary of Tuning for "Crash" Issues

If the vehicle "sometimes avoids perfectly but other times crashes":

1.  **Check `INFLATION_MARGIN_M`:** Ensure the map explicitly forbids the area close to the obstacle. Try increasing to `0.15` or `0.20`.
2.  **Reduce `MIN_L`:** In `planner.py`, reduce `MIN_L` to `0.8` or `1.0`. This forces the robot to follow the "safe" curve generated by A* rather than shortcutting across the danger zone.
3.  **Check `TURN_KP`:** Ensure the robot has enough steering power to make the turn required by the path.
